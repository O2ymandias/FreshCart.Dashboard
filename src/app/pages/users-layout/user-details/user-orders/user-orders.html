@let userOrders = orders();

@if (userOrders.length > 0) {
  <section class="flex flex-col gap-6">
    <p-table
      class="app-ring-1 overflow-hidden rounded-2xl"
      #dt
      [value]="userOrders"
      rowHover="true"
      dataKey="id"
    >
      <ng-template #caption>
        <div class="space-y-4">
          <div
            class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between"
          >
            <div class="flex flex-col gap-2">
              <div class="flex items-center gap-2">
                <h1 class="text-2xl font-bold">User Orders</h1>
              </div>
            </div>
          </div>
        </div>
      </ng-template>

      <ng-template #header>
        <tr>
          <th>Order ID</th>
          <th>Order Date</th>
          <th>Status</th>
          <th>Payment</th>
          <th>Total</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template #body let-userOrder>
        <tr>
          <td>{{ userOrder.orderId }}</td>
          <td>{{ userOrder.orderDate | date: "medium" }}</td>
          <td>
            <div class="flex items-center gap-2">
              <p-tag
                [severity]="statusToSeverity(userOrder.orderStatus)"
                [value]="userOrder.orderStatus"
                rounded
                class="font-medium"
              />
            </div>
          </td>
          <td>
            <div class="flex items-center gap-2">
              <p-tag
                [severity]="statusToSeverity(userOrder.paymentStatus)"
                [value]="userOrder.paymentStatus"
                rounded
                class="font-medium"
              />
            </div>
          </td>
          <td>{{ userOrder.total | currency: "USD" : "symbol" : "1.2-2" }}</td>
          <td>
            <div class="flex items-center gap-2">
              <p-button
                icon="pi pi-search"
                rounded
                outlined
                (onClick)="onSelectOrder(userOrder)"
              />
              <p-button icon="pi pi-cog" severity="info" rounded outlined />
            </div>
          </td></tr
      ></ng-template>

      <ng-template #footer>
        <tr>
          <td colspan="8">
            <p-paginator
              [rows]="pageSize()"
              [totalRecords]="totalRecords()"
              [rowsPerPageOptions]="rowsPerPageOptions"
              [first]="first()"
              [showCurrentPageReport]="true"
              [currentPageReportTemplate]="
                'Showing {first} to {last} of {totalRecords} entries'
              "
              (onPageChange)="onPageChange($event)"
            />
          </td>
        </tr>
      </ng-template>
    </p-table>
  </section>
}

@let selected = selectedOrder();
@if (selected) {
  <p-dialog
    header="Order Details"
    [modal]="true"
    [(visible)]="showOrderDetails"
  >
    <div class="my-4">
      <app-order-details [order]="selected" />
    </div>
  </p-dialog>
}
